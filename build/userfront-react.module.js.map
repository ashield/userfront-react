{"version":3,"file":"userfront-react.module.js","sources":["../src/index.js"],"sourcesContent":["import React from \"react\";\nimport AnyMod from \"@anymod/core\";\nimport Core from \"@userfront/core\";\n\nconst {\n  Singleton,\n  alias,\n  render,\n  processPage,\n  addScript1ToDocument,\n  createOrReturnPage,\n  checkPageAndUpdate,\n  executeCallbacks,\n  logErrorsAndTips,\n} = AnyMod;\n\nconst { registerUrlChangedEventListener, addInitCallback } = Core;\nalias.setAlias(\"Userfront\");\n\nSingleton.Opts.api = true;\n\n/**\n * The order of operations is:\n *  1. Userfront.init() is called\n *  2. Callback is fired that adds Script1 to document and sets Singleton.isScript1Loading = true\n *  3. Userfront.build() is called\n *  4. componentDidMount() is called\n *  5. mountTools() is called\n *  6a. If Script1 hasn't loaded yet, wait for it to load\n *  6b. If Script1 has loaded, continue\n *  7. runAnyModSetup() is called\n */\n\n// Callback to fire whenever Userfront.init is called\naddInitCallback(({ tenantId }) => {\n  Singleton.External.project = tenantId;\n  addScript1ToDocument(\n    \"https://cdn.userfront.com/toolkit/page/\",\n    tenantId,\n    runAnyModSetup\n  );\n});\n\nregisterUrlChangedEventListener();\n\nif (typeof window === \"object\") {\n  window.addEventListener(\"urlchanged\", render);\n}\n\nasync function runAnyModSetup() {\n  if (Singleton.isScript1Loading) return;\n  const page = await createOrReturnPage();\n  const updatedPage = await checkPageAndUpdate(page);\n  await processPage(updatedPage);\n  executeCallbacks();\n  logErrorsAndTips();\n}\n\nasync function mountTools() {\n  try {\n    runAnyModSetup();\n  } catch (err) {\n    let message = err && err.message ? err.message : \"Problem loading page\";\n    console.warn(message, err);\n  }\n}\n\n/**\n * This is the hook way to do it, which we're not\n * using because it's not compatible with older\n * versions of React.\n */\n// hook({ tenantId, toolId }) {\n//   return function Anon() {\n//     useEffect(() => {\n//       mount();\n//     });\n//     return (\n//       <div>\n//         <div id={`userfront-${toolId}`}></div>\n//       </div>\n//     );\n//   };\n// },\n\nclass Form extends React.PureComponent {\n  constructor(props) {\n    super(props);\n  }\n  componentDidMount() {\n    mountTools();\n  }\n  render() {\n    return (\n      <div>\n        <div id={`userfront-${this.props.toolId}`}></div>\n      </div>\n    );\n  }\n}\n\nexport function build({ toolId }) {\n  class Anon extends React.PureComponent {\n    componentDidMount() {\n      mountTools();\n    }\n    render() {\n      return (\n        <div>\n          <div id={`userfront-${toolId}`}></div>\n        </div>\n      );\n    }\n  }\n  return Anon;\n}\n\nexport function SignupForm({ toolId }) {\n  return <Form toolId={toolId} />;\n}\nexport function LoginForm({ toolId }) {\n  return <Form toolId={toolId} />;\n}\nexport function PasswordResetForm({ toolId }) {\n  return <Form toolId={toolId} />;\n}\nexport function LogoutButton({ toolId }) {\n  return <Form toolId={toolId} />;\n}\n\nconst Userfront = {\n  build,\n  SignupForm,\n  LoginForm,\n  PasswordResetForm,\n  LogoutButton,\n};\n\nfor (const attr in Core) {\n  if (!Userfront[attr]) {\n    Userfront[attr] = Core[attr];\n  }\n}\n\nexport default Userfront;\n\nmodule.exports = Userfront;\n"],"names":["mountTools","runAnyModSetup","err","console","warn","message","Singleton","isScript1Loading","createOrReturnPage","page","checkPageAndUpdate","updatedPage","processPage","executeCallbacks","logErrorsAndTips","alias","render","addScript1ToDocument","AnyMod","registerUrlChangedEventListener","addInitCallback","Core","setAlias","Opts","api","tenantId","External","project","window","addEventListener","Form","React","PureComponent","constructor","props","super","componentDidMount","id","this","toolId","build","SignupForm","LoginForm","PasswordResetForm","LogoutButton","Userfront","attr","module","exports"],"mappings":"sFA0DeA,iBACb,IACEC,IACA,MAAOC,GAEPC,QAAQC,KADMF,GAAOA,EAAIG,QAAUH,EAAIG,QAAU,uBAC3BH,GALE,6DATbD,iBACb,OAAIK,EAAUC,mDACKC,mBAAbC,0BACoBC,EAAmBD,kBAAvCE,0BACAC,EAAYD,oBAClBE,IACAC,+CAnDIR,UACJA,EADIS,MAEJA,EAFIC,OAGJA,EAHIJ,YAIJA,EAJIK,qBAKJA,EALIT,mBAMJA,EANIE,mBAOJA,EAPIG,iBAQJA,EARIC,iBASJA,GACEI,GAEEC,gCAAEA,EAAFC,gBAAmCA,GAAoBC,EAC7DN,EAAMO,SAAS,aAEfhB,EAAUiB,KAAKC,KAAM,EAerBJ,EAAgB,EAAGK,SAAAA,MACjBnB,EAAUoB,SAASC,QAAUF,EAC7BR,EACE,0CACAQ,EACAxB,KAIJkB,IAEsB,iBAAXS,QACTA,OAAOC,iBAAiB,aAAcb,GAuCxC,MAAMc,UAAaC,EAAMC,cACvBC,YAAYC,GACVC,MAAMD,GAERE,oBACEpC,IAEFgB,SACE,OACEe,2BACEA,uBAAKM,GAAK,aAAYC,KAAKJ,MAAMK,oBAMzBC,GAAMD,OAAEA,IAatB,OAZA,cAAmBR,EAAMC,cACvBI,oBACEpC,IAEFgB,SACE,OACEe,2BACEA,uBAAKM,GAAK,aAAYE,gBAQhBE,GAAWF,OAAEA,IAC3B,OAAOR,gBAACD,GAAKS,OAAQA,aAEPG,GAAUH,OAAEA,IAC1B,OAAOR,gBAACD,GAAKS,OAAQA,aAEPI,GAAkBJ,OAAEA,IAClC,OAAOR,gBAACD,GAAKS,OAAQA,aAEPK,GAAaL,OAAEA,IAC7B,OAAOR,gBAACD,GAAKS,OAAQA,IAGvB,MAAMM,EAAY,CAChBL,MAAAA,EACAC,WAAAA,EACAC,UAAAA,EACAC,kBAAAA,EACAC,aAAAA,GAGF,IAAK,MAAME,KAAQzB,EACZwB,EAAUC,KACbD,EAAUC,GAAQzB,EAAKyB,IAM3BC,OAAOC,QAAUH"}